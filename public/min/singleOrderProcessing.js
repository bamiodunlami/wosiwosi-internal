try{$(document).ready((()=>{!async function(){let e=$("#orderNumber").text();fetch(`/order-processing-status?id=${e}`,{method:"get"}).then((e=>e.json())).then((e=>{!function(e){const t=$(".product-table"),n=$("#duty").val(),r=e.hideProduct;for(const d of t){if(r.length>0)for(const e of r)$(d)[0].children[1].children[0].innerText===e&&("manager"==n?($(d)[0].children[5].children[0].disabled=!0,$(d)[0].children[5].children[0].checked=!0,$(d)[0].children[1].children[1].innerText=" Product Hidden"):($(d)[0].children[5].children[0].disabled=!0,$(d)[0].children[5].children[0].checked=!0,$(d).addClass("hidden")));for(const t of e.productPicked)$(d)[0].children[1].children[0].innerText===t&&($(d)[0].children[6].children[0].checked=!0);1==e.meatPicker.status&&1==e.dryPicker.status&&($("#dryPicked").prop("disabled",!0),$("#meatPicked").prop("disabled",!0),$("#completeBtn").prop("disabled",!1))}}(e),async function(e){const t=$("#orderNumber").text(),n=$("#dryPicked"),r=$(".product-table");$("#duty").val();n.on("click",(()=>{if(e.lock)alert("Order Locked");else{let e=[];for(const t of r)1==t.children[6].children[0].checked&&e.push(t.children[1].children[0].innerText);let d={id:t,product:e};fetch("/product-picked?request=dry-picked",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then((e=>e.json())).then((e=>{!0===e?(n.prop("disabled",!0),window.location.reload()):alert("Error, contact admin")}))}}))}(e),async function(e){const t=$("#orderNumber").text(),n=$("#meatPicked"),r=$(".product-table");$("#duty").val();n.on("click",(()=>{if(e.lock)alert("Order Locked");else{let e=[];for(const t of r)1==t.children[6].children[0].checked&&e.push(t.children[1].children[0].innerText);let d={id:t,product:e};fetch("/product-picked?request=meat-picked",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then((e=>e.json())).then((e=>{!0===e?(n.prop("disabled",!0),window.location.reload()):alert("Error, contact admin")}))}}))}(e),async function(e){const t=$("#orderNumber").text(),n=$("#completeBtn"),r=$(".product-table"),d=$("#duty").val();let o=[];n.on("click",(()=>{if(e.lock)alert("Order Locked");else{n.prop("disabled",!0);for(const e of r)0==e.children[5].children[0].checked&&o.push(e.children[1].children[0].innerText);if("packer"==d&&o.length>0)alert(`Kindly confirm the following products ${o}`),n.prop("disabled",!1),o=[];else{let e=[];for(const t of r)1==t.children[5].children[0].checked&&e.push(t.children[1].children[0].innerText);let n={id:t,product:e};fetch("/complete",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>{!0===e?window.location.href="/processingorder":alert("error")}))}}}))}(e)}))}(),async function(){fetch("/get-order-details",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderNumber:$("#orderNumber").text()})}).then((e=>e.json())).then((e=>{let t=e.product;const n=$(".product-table");for(const e of n)for(const n of t)n.productName===$(e)[0].children[1].children[0].innerText&&(1==n.approval?(console.log("approved"),$(e)[0].children[1].children[1].innerText=" refund Approved (refund "+n.productQuantity+" quantity)",$(e)[0].children[4].children[0].disabled=!0,$(e)[0].children[5].children[0].disabled=!0,$(e)[0].children[6].children[0].disabled=!0,$(e)[0].children[6].children[0].checked=!0):1==n.status&&0==n.approval?($(e)[0].children[1].children[1].innerText=" refund rejected",$(e)[0].children[4].children[0].disabled=!0,console.log("rejected")):($(e)[0].children[1].children[1].innerText=" awaiting approval to refund",$(e)[0].children[4].children[0].disabled=!0,$(e)[0].children[5].children[0].disabled=!0,console.log("awaiting")))}))}(),async function(){const e=$("#orderNumber").text(),t=$(".product-table");hideBtn=$("#hide-product");let n=[];hideBtn.on("click",(()=>{for(const e of t)1==e.children[5].children[0].checked&&n.push(e.children[1].children[0].innerText);let r={id:e,product:n};n.length>0?fetch("/hide-product",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{1==e&&window.location.reload()})):alert("Select product to lock")}))}(),async function(){let e=$("#orderNumber"),t=$("#userId"),n=$("#note"),r=$("#fname");$("#sendNoteBtn").on("click",(()=>{let d={orderNumber:e.text(),userFname:r.val(),userId:t.val(),note:n.val()};fetch("/note",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then((e=>e.json())).then((e=>{1==e?($("#note-msg").append(`<div class="alert alert-danger"> ${r.val()}: ${n.val()}</div>`),n.val("")):alert("Please try again or refresh the page")}))}))}(),async function(){let e=$("#assign-staff");e.on("change",(()=>{let t=e.val();if(""==t)alert("Kindly select a staff");else{let e={staffId:t,orderNumber:$("#orderNumber").text()};fetch("/assign-staff-to-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{1==e?(alert("Assign successful"),window.location.reload()):alert("Error, contact admin")}))}}))}(),async function(){let e,t=$(".replaceTrigger"),n=$(".productName");for(let r=0;r<t.length;r++)$(t[r]).on("click",(()=>{$(".ReplaceModalProductName").text($(n[r]).text()),e=$(n[r]).text()}));$("#replaceBtn").on("click",(()=>{detailToSend={staffUsername:$("#staffId").val(),staffName:$("#fname").val(),orderNumber:$("#orderNumber").text(),productName:e,replacementName:$("#replacementName").val(),replacementSize:$("#replacementSize").val(),replacementQty:$("#replacementQuantity").val()},fetch("/replace",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(detailToSend)}).then((e=>e.json())).then((e=>{1==e?(alert("Replacement saved"),window.location.reload()):console.log("Error, contact admin")}))}))}(),async function(){let e,t,n,r=$(".refundTrigger"),d=$(".productName"),o=$(".productQty"),c=$(".productPrice");for(let l=0;l<r.length;l++)$(r[l]).on("click",(()=>{let r=$(d[l]).text(),i=$(o[l]).text(),a=$(c[l]).text();$("#refundProduct").val(r),e=r,1==Number(i)?(n=i,t=Number(a.slice(1,a.length)),$("#refundQuantity").val(i),$("#refundPrice").val(a),$("#refundBtn").prop("disabled",!1),$("#refundQuantity").prop("disabled",!0),$("#refundPrice").prop("disabled",!0)):$("#refundQuantity").on("keyup",(()=>{if($("#refundQuantity").val()>Number(i)||""==$("#refundQuantity").val())$("#quantityError").text("Kindly confirm the quantity"),$("#refundBtn").prop("disabled",!0);else{$("#quantityError").text(""),$("#refundBtn").prop("disabled",!1);let e=1*Number(a.slice(1,a.length))/Number(i);t=$("#refundQuantity").val()*e,$("#refundPrice").val("Â£"+t),n=$("#refundQuantity").val()}}))}));$("#refundBtn").on("click",(()=>{$("#refundBtn").prop("disabled",!0),detailToSend={staffUsername:$("#staffId").val(),staffName:$("#fname").val(),orderNumber:$("#orderNumber").text(),productName:e,productQuantity:n,productPrice:t},fetch("/refund",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(detailToSend)}).then((e=>e.json())).then((e=>{1==e?(alert("Refund sent for approval"),window.location.reload()):console.log("Refund not allowed")}))}))}(),async function(){let e=$("#saveBtn"),t=$("#orderNumber");e.on("click",(()=>{let e={data:[t.text()]};fetch("/saveorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.text())).then((e=>{alert(e),window.location.reload()}))}))}()}))}catch(e){}