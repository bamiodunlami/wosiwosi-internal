try{$(document).ready((()=>{!async function(){const e=$(".product-table"),t=$("#duty").val();let n=$("#orderNumber").text();fetch(`/order-processing-status?id=${n}`,{method:"get"}).then((e=>e.json())).then((n=>{const r=n.meatPicker.product,d=n.dryPicker.product,o=n.packer.product;let c,i;n.productPicked?(c=n.productPicked,i=r.concat(d,o,c)):i=r.concat(d,o);const l=n.hideProduct;for(const r of e){if(l.length>0)for(const e of l)$(r)[0].children[1].children[0].innerText===e&&("manager"==t?($(r)[0].children[5].children[0].disabled=!0,$(r)[0].children[5].children[0].checked=!0,$(r)[0].children[1].children[1].innerText=" Product Hidden"):($(r)[0].children[5].children[0].disabled=!0,$(r)[0].children[5].children[0].checked=!0,$(r).addClass("hidden")));for(const e of i)$(r)[0].children[1].children[0].innerText===e&&($(r)[0].children[5].children[0].checked=!0);1==n.meatPicker.status&&1==n.dryPicker.status&&($("#dryPicked").prop("disabled",!0),$("#meatPicked").prop("disabled",!0),$("#completeBtn").prop("disabled",!1))}}))}(),async function(){fetch("/get-order-details",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderNumber:$("#orderNumber").text()})}).then((e=>e.json())).then((e=>{let t=e.product;const n=$(".product-table");for(const e of n)for(const n of t)n.productName===$(e)[0].children[1].children[0].innerText&&(1==n.approval?(console.log("approved"),$(e)[0].children[1].children[1].innerText=" refund Approved (refund "+n.productQuantity+" quantity)",$(e)[0].children[4].children[0].disabled=!0,$(e)[0].children[5].children[0].disabled=!0,$(e)[0].children[5].children[0].checked=!0):1==n.status&&0==n.approval?($(e)[0].children[1].children[1].innerText=" refund rejected",$(e)[0].children[4].children[0].disabled=!0,console.log("rejected")):($(e)[0].children[1].children[1].innerText=" awaiting approval to refund",$(e)[0].children[4].children[0].disabled=!0,$(e)[0].children[5].children[0].disabled=!0,console.log("awaiting")))}))}(),async function(){const e=$("#orderNumber").text(),t=$(".product-table");hideBtn=$("#hide-product");let n=[];hideBtn.on("click",(()=>{for(const e of t)1==e.children[5].children[0].checked&&n.push(e.children[1].children[0].innerText);let r={id:e,product:n};n.length>0?fetch("/hide-product",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{1==e&&window.location.reload()})):alert("Select product to lock")}))}(),async function(){let e=$("#orderNumber"),t=$("#userId"),n=$("#note"),r=$("#fname");$("#sendNoteBtn").on("click",(()=>{let d={orderNumber:e.text(),userFname:r.val(),userId:t.val(),note:n.val()};fetch("/note",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then((e=>e.json())).then((e=>{1==e?($("#note-msg").append(`<div class="alert alert-danger"> ${r.val()}: ${n.val()}</div>`),n.val("")):alert("Please try again or refresh the page")}))}))}(),async function(){let e=$("#assign-staff");e.on("change",(()=>{let t=e.val();if(""==t)alert("Kindly select a staff");else{let e={staffId:t,orderNumber:$("#orderNumber").text()};fetch("/assign-staff-to-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{1==e?(alert("Assign successful"),window.location.reload()):alert("Error, contact admin")}))}}))}(),async function(){let e,t,n,r=$(".refundTrigger"),d=$(".productName"),o=$(".productQty"),c=$(".productPrice");for(let i=0;i<r.length;i++)$(r[i]).on("click",(()=>{let r=$(d[i]).text(),l=$(o[i]).text(),a=$(c[i]).text();$("#refundProduct").val(r),e=r,1==Number(l)?(n=l,t=Number(a.slice(1,a.length)),$("#refundQuantity").val(l),$("#refundPrice").val(a),$("#refundBtn").prop("disabled",!1),$("#refundQuantity").prop("disabled",!0),$("#refundPrice").prop("disabled",!0)):$("#refundQuantity").on("keyup",(()=>{if($("#refundQuantity").val()>Number(l)||""==$("#refundQuantity").val())$("#quantityError").text("Kindly confirm the quantity"),$("#refundBtn").prop("disabled",!0);else{$("#quantityError").text(""),$("#refundBtn").prop("disabled",!1);let e=1*Number(a.slice(1,a.length))/Number(l);t=$("#refundQuantity").val()*e,$("#refundPrice").val("Â£"+t),n=$("#refundQuantity").val()}}))}));$("#refundBtn").on("click",(()=>{$("#refundBtn").prop("disabled",!0),detailToSend={staffUsername:$("#staffId").val(),staffName:$("#fname").val(),orderNumber:$("#orderNumber").text(),productName:e,productQuantity:n,productPrice:t},fetch("/refund",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(detailToSend)}).then((e=>e.json())).then((e=>{1==e?(alert("Refund sent for approval"),window.location.reload()):console.log("Refund not allowed")}))}))}(),async function(){let e=$("#saveBtn"),t=$("#orderNumber");e.on("click",(()=>{let e={data:[t.text()]};fetch("/saveorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.text())).then((e=>{alert(e),window.location.reload()}))}))}(),async function(){const e=$("#orderNumber").text(),t=$("#completeBtn"),n=$(".product-table"),r=$("#duty").val();let d=[];t.on("click",(()=>{t.prop("disabled",!0);for(const e of n)0==e.children[5].children[0].checked&&d.push(e.children[1].children[0].innerText);if("packer"==r&&d.length>0)alert(`Kindly confirm the following products ${d}`),t.prop("disabled",!1),d=[];else{let t=[];for(const e of n)1==e.children[5].children[0].checked&&t.push(e.children[1].children[0].innerText);let r={id:e,product:t};fetch("/complete",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{!0===e?window.location.href="/processingorder":alert("error")}))}}))}(),async function(){const e=$("#orderNumber").text(),t=$("#dryPicked"),n=$(".product-table");$("#duty").val();t.on("click",(()=>{let r=[];for(const e of n)1==e.children[5].children[0].checked&&r.push(e.children[1].children[0].innerText);let d={id:e,product:r};fetch("/product-picked?request=dry-picked",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then((e=>e.json())).then((e=>{!0===e?(t.prop("disabled",!0),window.location.reload()):alert("Error, contact admin")}))}))}(),async function(){const e=$("#orderNumber").text(),t=$("#meatPicked"),n=$(".product-table");$("#duty").val();t.on("click",(()=>{let r=[];for(const e of n)1==e.children[5].children[0].checked&&r.push(e.children[1].children[0].innerText);let d={id:e,product:r};fetch("/product-picked?request=meat-picked",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then((e=>e.json())).then((e=>{!0===e?(t.prop("disabled",!0),window.location.reload()):alert("Error, contact admin")}))}))}()}))}catch(e){}